{
    "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
    "title": {
    "text": "Income Distribution Patterns Across Malaysian States",
    "anchor": "start",
    "fontSize": 12,
    "subtitle": "year range can be filtered by selecting desired year below",
    "subtitleFontSize": 10.5,
    "subtitleColor": "gray",
    "subtitlePadding": 15
  },
    "width": 650,
    "height": 400,
    "data": {"url": "https://raw.githubusercontent.com/Lez-ley/FIT3179/main/Visualization2/hh_income_state.csv"},
    "params": [
        {
            "name": "selectYear",
            "value": 2022,
            "bind": {
                "input": "select",
                "options": [
                    1976,1979,1984,1987,1989,
                    1992,1995,1997,1999,2002,2004,2007,
                    2009,2012,2014,2016,2019,2020,2022
                ],
                "labels": [
                    "1976","1979","1984","1987","1989",
                    "1992","1995","1997","1999","2002","2004","2007",
                    "2009","2012","2014","2016","2019","2020","2022"
                ],
                "name": "In the Year "
            }
        }
    ],
    "transform": [
        {
            "filter": " datum.state != 'W.P. Kuala Lumpur' && datum.state != 'W.P. Labuan' && datum.state != 'W.P. Putrajaya'"
        },
        {
            "calculate": "toDate(datum.date)",
            "as": "parsed_date"
        },
        {
            "filter": "year(datum.parsed_date) == selectYear"
        },
        {
            "fold": ["income_mean", "income_median"],
            "as": ["income_type", "income_amount"]
        },
        {
            "calculate": "datum.income_type == 'income_mean' ? 'Income Mean' : 'Income Median' ",
            "as": "incomeTypeLabel"
        },
        {
            "calculate": "datum.income_mean - datum.income_median",
            "as": "disparity"
        }
    ],
    "layer": [
        {
            "mark": {
                "type": "rule",
                "tooltip": true,
                "strokeWidth": 0.5,
                "strokeOpacity": 1
            },
            "encoding": {
                "x": {
                    "field": "state",
                    "type": "nominal",
                    "axis": {
                        "title": "States"
                    }
                },
                "y": {
                    "field": "income_median",
                    "type": "quantitative",
                    "axis": {
                        "title": "Income (RM)"
                    }
                },
                "y2": {
                    "field": "income_mean",
                    "type": "quantitative"
                },
                "tooltip": [
                    {"field": "income_mean", "type": "quantitative", "title": "Mean (RM)"},
                    {"field": "income_median", "type": "quantitative", "title": "Median (RM)"},
                    {"field": "disparity", "type": "quantitative", "title": "Disparity (RM)"}
                ]
            }
        },
        {
            "mark": {
                "type": "point",
                "filled": true,
                "tooltip": true,
                "size": 70,
                "opacity": 1
            },
            "encoding": {
                "x": {
                    "field": "state",
                    "type": "nominal"
                },
                "y": {
                    "field": "income_amount",
                    "type": "quantitative"
                },
                "color": {
                    "field": "incomeTypeLabel",
                    "type": "nominal",
                    "scale": {
                        "range": ["#4e79a9", "darkorange"]} ,
                    "legend": {
                        "title": "Income Type",
                        "symbolOpacity": 1
                    }
                },
                "tooltip": [
                    {"field": "incomeTypeLabel", "type": "nominal", "title": "Type"},
                    {"field": "income_amount", "type": "quantitative", "title": "Amount (RM)"}
                ]
            }
        }
    ]
}
