{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "title": {
        "text": "Mean and Median Household Income",
        "anchor": "start",
        "fontSize": 12,
        "subtitle": "Year range can be filtered by selecting desired 'FROM' and 'UNTIL' below",
        "subtitleFontSize": 10.5,
        "subtitleColor": "gray",
        "subtitlePadding": 15
    },
    "width": 700,
    "height": 400,
    "data": {
        "url": "https://raw.githubusercontent.com/Lez-ley/FIT3179/main/Visualization2/data/hh_income.csv"
    },
    "params": [
        {
            "name": "fromYear",
            "value": 1970,
            "bind": {
                "input": "select",
                "options": [
                    1974,1976,1979,1984,1987,1989,
                    1992,1995,1997,1999,2002,2004,2007,
                    2009,2012,2014,2016,2019,2020
                ],
                "labels": [
                    "1974","1976","1979","1984","1987","1989",
                    "1992","1995","1997","1999","2002","2004","2007",
                    "2009","2012","2014","2016","2019","2020"
                ],
                "name": "From Year "
            }
        },
        {
            "name": "toYear",
            "value": 2022,
            "bind": {
                "input": "select",
                "options": [
                    1976,1979,1984,1987,1989,
                    1992,1995,1997,1999,2002,2004,2007,
                    2009,2012,2014,2016,2019,2020,2022
                ],
                "labels": [
                    "1976","1979","1984","1987","1989",
                    "1992","1995","1997","1999","2002","2004","2007",
                    "2009","2012","2014","2016","2019","2020","2022"
                ],
                "name": "Until Year "
            }
        }
    ],
    "transform": [
        {
        "filter": "year(datum.date) >= fromYear && year(datum.date) <= toYear"
        },
        {"fold": ["income_mean", "income_median"], "as": ["income_type", "income_amount"]},
        {
            "calculate": " datum.income_type == 'income_mean' ? 'Income Mean' : 'Income Median' ",
            "as": "incomeTypeLabel"
        }
    ],
    "layer": [
        {
            "mark": {
                "type": "line"
            },
            "encoding": {
                "x": {
                    "field": "date",
                    "type": "temporal",
                    "title": "Year",
                    "timeUnit": "year",
                    "axis": {
                        "format": "%Y",
                        "tickCount": "year",
                        "grid": false
                    }
                },
                "y": {
                    "field": "income_amount",
                    "type": "quantitative",
                    "title": "Income (RM)",
                    "axis": {
                        "grid": true
                    }
                },
                "color": {
                    "field": "incomeTypeLabel",
                    "type": "nominal",
                    "title": "Income Type",
                    "scale": {
                        "domain": ["Income Mean", "Income Median"],
                        "range": ["#1f77b4", "#ff7f0e"]
                    }
                }
            }
        },
        {
            "selection": {
                "highlight": {
                    "type": "single",
                    "on": "mouseover",
                    "fields": ["date", "income_type"],
                    "empty": "none"
                }
            },
            "mark": {
                "type": "point",
                "filled": true,
                "size": 15,
                "opacity": 1
            },
            "encoding": {
                "x": {"field": "date", "type": "temporal"},
                "y": {"field": "income_amount", "type": "quantitative"},
                "color": {"field": "incomeTypeLabel", "type": "nominal"},
                "size": {
                    "condition": {"selection": "highlight", "value": 70},
                    "value": 20
                },
                "tooltip": [
                {"field": "date", "type": "temporal", "title": "Year", "timeUnit": "year", "format": "%Y"},
                {"field": "income_amount", "type": "quantitative", "title": "Amount (RM)"},
                {"field": "incomeTypeLabel", "type": "nominal", "title": "Type"}
                ]
            }
        },
        {
            "data": {
                "values": [
                    {"date": "01-01-1997", "label": "1997 | Asian Financial Crisis", "color": "red"},
                    {
                        "date": "01-01-2020",
                        "label": "‎                   2020 | Covid-19",
                        "color": "red"
                    }
                ]
            },
            "transform": [
                {"calculate": "toDate(datum.date)", "as": "parsed_date"},
                {
                    "filter": " year(datum.parsed_date) >= fromYear && year(datum.parsed_date) <= toYear "
                }
            ],
            "layer": [
                {
                    "mark": {"type": "rule", "color": "red", "strokeWidth": 1, "strokeDash": [4, 4]},
                    "encoding": {
                        "x": {"field": "parsed_date", "type": "temporal"}
                    }
                },
                {
                    "mark": {
                        "type": "text",
                        "align": "center",
                        "baseline": "middle",
                        "dy": -180,
                        "dx": -80,
                        "fontSize": 11,
                        "fontWeight": "normal"
                    },
                    "encoding": {
                        "x": {"field": "parsed_date", "type": "temporal"},
                        "text": {"field": "label"},
                        "color": {"value": "red"}
                    }
                }
            ]
        }
    ]
}
