{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
        "text": "The Momentum: How Are Incomes Growing and Slowing",
        "anchor": "start",
        "fontSize": 12,
        "subtitle": "year range can be filtered by selecting desired 'From' and 'Until' below",
        "subtitleFontSize": 10.5,
        "subtitleColor": "gray",
        "subtitlePadding": 15
    },
  "width": 700,
  "height": 200,
  "data": {
    "url": "https://raw.githubusercontent.com/Lez-ley/FIT3179/main/Visualization2/data/hh_income.csv"
  },
  "params": [
        {
          "name": "fromYear",
          "value": 1970,
          "bind": {
              "input": "select",
              "options": [
                  1974,1976,1979,1984,1987,1989,
                  1992,1995,1997,1999,2002,2004,2007,
                  2009,2012,2014,2016,2019,2020
              ],
              "labels": [
                  "1974","1976","1979","1984","1987","1989",
                  "1992","1995","1997","1999","2002","2004","2007",
                  "2009","2012","2014","2016","2019","2020"
              ],
              "name": "From Year "
          }
        },
        {
          "name": "toYear",
          "value": 2022,
          "bind": {
              "input": "select",
              "options": [
                  1976,1979,1984,1987,1989,
                  1992,1995,1997,1999,2002,2004,2007,
                  2009,2012,2014,2016,2019,2020,2022
              ],
              "labels": [
                  "1976","1979","1984","1987","1989",
                  "1992","1995","1997","1999","2002","2004","2007",
                  "2009","2012","2014","2016","2019","2020","2022"
              ],
              "name": "Until Year "
          }
        }
  ],
  "transform": [
    {
        "filter": "year(datum.date) >= fromYear && year(datum.date) <= toYear"
    },
    {
      "window": [
        {
          "op": "lag",
          "field": "income_mean",
          "as": "prev_income"
        }
      ],
      "sort": [{"field": "date", "order": "ascending"}]
    },
    {
      "calculate": "(datum.income_mean - datum.prev_income) / datum.prev_income * 100",
      "as": "growth_rate"
    }
  ],
  "layer": [
    {
      "mark": {"type": "line", "point": true},
      "encoding": {
        "x": {
            "field": "date",
            "type": "temporal",
            "title": "Year",
            "timeUnit": "year",
            "axis": {"grid": false, "tickCount": "year", "format": "%Y"}
        },
        "y": {
          "field": "growth_rate",
          "type": "quantitative",
          "title": "Growth Rate (%)",
          "axis": {"grid": true, "format": ".1f"}
        },
        "tooltip": [
          {"field": "date", "type": "temporal", "title": "Year", "format": "%Y"},
          {"field": "growth_rate", "type": "quantitative", "title": "Growth Rate", "format": ".2f"}
        ]
      }
    },
    {
      "mark": {
        "type": "rule",
        "color": "black",
        "opacity": 0.075,
        "strokeDash": [4, 7]
      },
      "encoding": {
        "y": {"datum": 0}
      }
    },
    {
            "data": {
                "values": [
                    {"date": "01-01-1997", "label": "1997 | Asian Financial Crisis", "color": "red"},
                    {
                        "date": "01-01-2020",
                        "label": "‎                   2020 | Covid-19",
                        "color": "red"
                    }
                ]
            },
            "transform": [
                {"calculate": "toDate(datum.date)", "as": "parsed_date"},
                {
                    "filter": " year(datum.parsed_date) >= fromYear && year(datum.parsed_date) <= toYear "
                }
            ],
            "layer": [
                {
                    "mark": {"type": "rule", "color": "red", "strokeWidth": 1, "strokeDash": [4, 4]},
                    "encoding": {
                        "x": {"field": "parsed_date", "type": "temporal"}
                    }
                },
                {
                    "mark": {
                        "type": "text",
                        "align": "center",
                        "baseline": "middle",
                        "dy": -90,
                        "dx": -80,
                        "fontSize": 11,
                        "fontWeight": "normal"
                    },
                    "encoding": {
                        "x": {"field": "parsed_date", "type": "temporal"},
                        "text": {"field": "label"},
                        "color": {"value": "red"}
                    }
                }
            ]
        }
  ]
}